<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin · 신고 관리</title>

  <!-- 공용 스타일 -->
  <link rel="stylesheet" href="css/tokens.css" />
  <link rel="stylesheet" href="css/components.css" />
  <link rel="stylesheet" href="css/admin.css" />

  <!-- 신고 전용 스타일 -->
  <link rel="stylesheet" href="css/admin_reports.css" />

  <script defer src="js/theme.js"></script>
</head>
<body class="admin">
<div class="admin-layout">
  <!-- 사이드바 -->
  <aside class="side">
    <div class="logo">LOGO</div>
    <nav class="sidemenu">
      <a class="m" href="admin.html">대시보드</a>
      <a class="m active" href="admin_reports.html">신고 관리</a>
      <a class="m" href="admin_recipes.html">레시피/댓글 관리</a>
      <a class="m" href="admin_users.html">유저 관리</a>
      <a class="m" href="admin_settings.html">세팅</a>
    </nav>
  </aside>

  <!-- 보드 -->
  <main class="board">
    <div class="topbar">
      <h1>신고 관리</h1>
    </div>

    <!-- KPI -->
    <section class="card" aria-labelledby="kpiTitle">
      <h2 class="card-title" id="kpiTitle">오늘 신고 현황</h2>
      <div class="kpi-grid">
        <div class="kpi">
          <span class="k-label">오늘 신고</span>
          <span class="k-num">15</span>
        </div>
        <div class="kpi">
          <span class="k-label">미처리</span>
          <span class="k-num">7</span>
        </div>
      </div>
    </section>

    <!-- 신고 누적 Top (여기서도 검토 버튼으로 바로 처리) -->
    <section class="card" aria-labelledby="topTitle">
      <h2 class="card-title" id="topTitle">신고 누적 Top 레시피</h2>
      <div class="top-list">
        <ul>
          <li>
            <span>r_330 · 매운 닭볶음탕 (userA)</span>
            <span style="display:flex; gap:8px; align-items:center;">
              <span class="badge warn">12건</span>
              <button
                  class="btn-ghost small"
                  data-open="reportModal"
                  data-type="레시피"
                  data-target-id="r_330"
                  data-preview="레시피: 매운 닭볶음탕 (작성자: userA)"
                  data-total="12"
                  data-last="2025-08-21 09:10"
              >검토</button>
            </span>
          </li>
          <li>
            <span>r_124 · 김치찌개 (userB)</span>
            <span style="display:flex; gap:8px; align-items:center;">
              <span class="badge warn">9건</span>
              <button
                  class="btn-ghost small"
                  data-open="reportModal"
                  data-type="레시피"
                  data-target-id="r_124"
                  data-preview="레시피: 김치찌개 (작성자: userB)"
                  data-total="9"
                  data-last="2025-08-22 18:42"
              >검토</button>
            </span>
          </li>
        </ul>
      </div>
    </section>

    <!-- (교체 전) 전체 신고 목록 테이블 섹션 -->
    <!-- (교체 후) 카드 리스트 섹션 -->
    <section class="card" aria-labelledby="listTitle">
      <h2 class="card-title" id="listTitle">전체 신고 목록</h2>
      <div class="report-list">
        <ul>
          <!-- 아이템 1 -->
          <li>
            <div class="report-item">
              <div class="report-title">#245 · 댓글 · 스팸/광고</div>
              <div class="report-meta">
                <span>신고자: user33</span>
                <span>일시: 2025-08-24 12:30</span>
              </div>
            </div>
            <div class="report-right">
              <span class="badge warn">대기</span>
              <button
                  class="btn-ghost small"
                  data-open="reportModal"
                  data-type="댓글"
                  data-target-id="c_245"
                  data-preview="댓글: “링크 클릭하세요!” (작성자: user99)"
                  data-total="3"
                  data-last="2025-08-24 12:30"
              >검토</button>
            </div>
          </li>

          <!-- 아이템 2 (예시) -->
          <li>
            <div class="report-item">
              <div class="report-title">#330 · 레시피 · 부적절한 내용</div>
              <div class="report-meta">
                <span>신고자: user12</span>
                <span>일시: 2025-08-23 09:50</span>
              </div>
            </div>
            <div class="report-right">
              <span class="badge ok">처리완료</span>
              <button
                  class="btn-ghost small"
                  data-open="reportModal"
                  data-type="레시피"
                  data-target-id="r_330"
                  data-preview="레시피: 매운 닭볶음탕 (작성자: userA)"
                  data-total="12"
                  data-last="2025-08-23 09:50"
              >검토</button>
            </div>
          </li>
        </ul>
      </div>
    </section>

  </main>
</div>

<!-- 신고 상세 모달 -->
<div class="modal" id="reportModal" aria-hidden="true">
  <div class="overlay" data-close></div>
  <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="reportTitle">
    <div class="dialog-head">
      <h3 id="reportTitle">신고 상세</h3>
      <button class="close" data-close aria-label="닫기">×</button>
    </div>
    <div class="dialog-body">
      <!-- 메타 정보 -->
      <div class="row" style="gap:16px; flex-wrap:wrap;">
        <div><strong style="min-width:auto;">대상</strong> <span id="metaType">-</span></div>
        <div><strong style="min-width:auto;">ID</strong> <span id="metaTarget">-</span></div>
        <div><strong style="min-width:auto;">누적 신고</strong> <span id="metaTotal">-</span></div>
        <div><strong style="min-width:auto;">최근 신고</strong> <span id="metaLast">-</span></div>
      </div>

      <!-- 신고된 내용/미리보기 -->
      <div style="background:#F9FBE7; border:1px solid var(--line); border-radius:8px; padding:12px; font-size:14px;">
        <div id="reportedPreview">내용 로딩 중…</div>
      </div>

      <!-- 조치 -->
      <label class="row" style="margin-top:10px;">
        <span>조치</span>
        <select class="input" id="actionSelect">
          <option>유지(문제 없음)</option>
          <option>댓글 숨기기</option>
          <option>작성자 정지</option>
        </select>
      </label>

      <!-- 정지 기간 -->
      <div class="row col" id="banPeriodRow" style="display:none;">
        <label><input type="radio" name="banPeriod" value="3일"> 3일</label>
        <label><input type="radio" name="banPeriod" value="7일"> 7일</label>
        <label><input type="radio" name="banPeriod" value="15일"> 15일</label>
        <label><input type="radio" name="banPeriod" value="영구"> 영구</label>
      </div>
    </div>
    <div class="dialog-foot">
      <button class="btn-ghost" data-close>취소</button>
      <button class="btn danger" id="banBtn">정지</button>
      <button class="btn success" id="processBtn">처리 완료</button>
    </div>
  </div>
</div>

<script>
  // 모달 Open: 버튼의 data-*로 모달 내용 채우기
  document.querySelectorAll('[data-open]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const modal = document.getElementById(btn.dataset.open);

      // 메타 채우기
      document.getElementById('metaType').textContent   = btn.dataset.type || '-';
      document.getElementById('metaTarget').textContent = btn.dataset.targetId || '-';
      document.getElementById('metaTotal').textContent  = btn.dataset.total || '-';
      document.getElementById('metaLast').textContent   = btn.dataset.last || '-';

      // 내용 미리보기
      document.getElementById('reportedPreview').textContent = btn.dataset.preview || '내용 없음';

      // 기본 선택값 초기화
      const actionSelect = document.getElementById('actionSelect');
      const banPeriodRow = document.getElementById('banPeriodRow');
      actionSelect.value = '유지(문제 없음)';
      banPeriodRow.style.display = 'none';
      document.querySelectorAll('input[name="banPeriod"]').forEach(r => r.checked = false);

      // 열기
      modal.setAttribute('aria-hidden','false');
      document.documentElement.style.overflow = 'hidden'; // (선택) 배경 스크롤 잠금
    });
  });

  // 모달 Close
  document.querySelectorAll('[data-close]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const modal = btn.closest('.modal');
      modal.setAttribute('aria-hidden','true');
      document.documentElement.style.overflow = '';
    });
  });

  // 조치 선택 → 정지 기간 보이기
  const actionSelect = document.getElementById('actionSelect');
  const banPeriodRow = document.getElementById('banPeriodRow');
  actionSelect?.addEventListener('change', ()=>{
    banPeriodRow.style.display = (actionSelect.value === '작성자 정지') ? 'block' : 'none';
  });

  // 처리 완료 (더미)
  document.getElementById('processBtn')?.addEventListener('click', ()=>{
    const t  = document.getElementById('metaType').textContent;
    const id = document.getElementById('metaTarget').textContent;
    const action = actionSelect.value;
    const period = document.querySelector('input[name="banPeriod"]:checked')?.value;
    alert(action === '작성자 정지'
        ? `[${t}:${id}] 정지 기간: ${period||'미선택'}`
        : `[${t}:${id}] 조치: ${action}`);
    document.getElementById('reportModal').setAttribute('aria-hidden','true');
    document.documentElement.style.overflow = '';
  });

  // 정지 (더미)
  document.getElementById('banBtn')?.addEventListener('click', ()=>{
    const t  = document.getElementById('metaType').textContent;
    const id = document.getElementById('metaTarget').textContent;
    const period = document.querySelector('input[name="banPeriod"]:checked')?.value || '기간 미선택';
    alert(`[${t}:${id}] 사용자 정지: ${period}`);
    document.getElementById('reportModal').setAttribute('aria-hidden','true');
    document.documentElement.style.overflow = '';
  });
</script>
</body>
</html>
