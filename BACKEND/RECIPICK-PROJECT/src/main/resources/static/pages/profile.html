<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="_csrf" content="${_csrf.token}">
  <meta name="_csrf_header" content="${_csrf.headerName}">

  <title>마이페이지</title>

  <!-- 수정된 프로필 전용 스타일 -->
  <link rel="stylesheet" href="../css/profile.css" />
  <script src="../js/common_tabbar.js" defer></script>
  <!-- 기존 동작(JS 렌더/모달/탭 전환 등)은 외부 스크립트에서 처리 -->
  <script src="../js/profile.js" defer></script>
</head>
<body class="detail">
<main class="frame" role="main" aria-label="마이페이지">
  <!-- ========== 헤더 ========== -->
  <header class="head">
    <!-- 브라우저 히스토리 기반 뒤로가기 -->
    <button class="back" aria-label="뒤로 가기" type="button" onclick="history.back()">
      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M15 6l-6 6 6 6"/>
      </svg>
    </button>
    <h1>마이페이지</h1>
    <div class="spacer" aria-hidden="true"></div>
  </header>

  <!-- ========== 프로필 상단(아바타/닉네임/등급) ========== -->
  <section class="profile-box" aria-labelledby="my-profile-title">
    <h2 id="my-profile-title" class="sr-only"></h2>
    <!-- 아바타(라벨 클릭으로 파일 인풋 트리거) -->
    <label class="avatar">
      <img id="avatarImg" alt="프로필 이미지" />
      <span class="avatar-ring" aria-hidden="true"></span>
    </label>

    <!-- 닉네임/등급 -->
    <div class="info">
      <div id="userName" class="name"></div>
      <!-- enum: BRONZE | SILVER | GOLD | PLATINUM | DIAMOND -->
      <div id="userTier" class="badge tier" data-tier="BRONZE" aria-live="polite"></div>
    </div>

    <!-- 프로필 편집(모달 열기) -->
    <button class="edit-btn" id="openEdit" type="button">프로필 편집</button>
  </section>

  <!-- ========== 상단 탭: 페이지 이동 없이 섹션만 전환 ========== -->
  <nav class="tabs" role="tablist" aria-label="프로필 탭">
    <a class="tab-btn active"
            id="tabbtn-my"
            href="#my"
            data-target="my"
            role="tab"
            aria-selected="true"
            aria-controls="tab-my">나의 레시피</a>

    <a class="tab-btn"
            id="tabbtn-saved"
            href="#saved"
            data-target="saved"
            role="tab"
            aria-selected="false"
            aria-controls="tab-saved">저장한 레시피</a>

    <a class="tab-btn"
            id="tabbtn-activity"
            href="#activity"
            data-target="activity"
            role="tab"
            aria-selected="false"
            aria-controls="tab-activity">댓글/활동</a>
  </nav>

  <!-- ========== 탭 패널: 기본은 '나의 레시피' 표시 ========== -->
  <section class="tab-content">
    <!-- 나의 레시피(임시/내 게시물) -->
    <div id="tab-my" class="tab-panel active" role="tabpanel" aria-labelledby="tabbtn-my">
      <ul id="listMine" class="cards"></ul>
      <div class="empty" data-empty-mine hidden>아직 임시 레시피가 없어요.</div>
    </div>

    <!-- 저장한 레시피(좋아요/저장 목록) -->
    <div id="tab-saved" class="tab-panel" role="tabpanel" aria-labelledby="tabbtn-saved" hidden>
      <ul id="listSaved" class="cards linkable"></ul>
      <div class="empty" data-empty-saved hidden>저장한 레시피가 없어요.</div>
    </div>

    <!-- 댓글/활동 -->
    <div id="tab-activity" class="tab-panel" role="tabpanel" aria-labelledby="tabbtn-activity" hidden>
      <ul id="listActivity" class="cards"></ul>
      <div class="empty" data-empty-activity hidden>활동 내역이 없어요.</div>
    </div>
  </section>
</main>

<!-- 
  기존의 하단 탭바와 바텀시트 코드는 제거됨
  대신 unified_common_tabbar.js가 자동으로 생성하고 관리함
-->

<!-- ========== 해시(#saved 등)로 진입 시 초기 탭 자동 선택 ========== -->
<script>
  (function(){
    function selectTab(target){
      // 버튼 상태
      document.querySelectorAll(".tab-btn").forEach(b=>{
        const on = b.dataset.target === target;
        b.classList.toggle("active", on);
        b.setAttribute("aria-selected", on ? "true" : "false");
      });
      // 패널 상태
      document.querySelectorAll(".tab-panel").forEach(p=>{
        const on = p.id === `tab-${target}`;
        p.classList.toggle("active", on);
        p.hidden = !on;
      });
    }
    // 초기 해시 파싱 → 유효하면 즉시 적용
    const initial = (location.hash || "").replace("#","");
    if (["my","saved","activity"].includes(initial)) {
      selectTab(initial);
    }
    // 같은 페이지 내에서 하트 누를 때도 해시 변경을 반영
    window.addEventListener("hashchange", ()=>{
      const t = (location.hash || "").replace("#","");
      if (["my","saved","activity"].includes(t)) selectTab(t);
    });
  })();
</script>
</body>
</html>