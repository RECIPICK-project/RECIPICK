<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>레시피 상세</title>
  <link rel="stylesheet" href="css/tokens.css" />
  <link rel="stylesheet" href="css/components.css" />
  <link rel="stylesheet" href="css/recipe_detail.css" />
  <script defer src="js/theme.js"></script>

  <script>
    // 화면 실제 가시 높이로 --app-vh 갱신 (모바일 주소창 변화 대응)
    function setVH(){
      document.documentElement.style.setProperty('--app-vh', window.innerHeight + 'px');
    }
    setVH();
    window.addEventListener('resize', setVH);
    window.addEventListener('orientationchange', setVH);
  </script>

</head>
<body class="detail">
<main class="phone recipe-detail" role="main" aria-label="레시피 상세">
  <header class="head">
    <button class="back" aria-label="뒤로 가기" onclick="history.back()">
      <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="#111827" stroke-width="2">
        <path d="M15 6l-6 6 6 6"/>
      </svg>
    </button>
    <h1>레시피 상세</h1>
    <span style="width:40px;height:40px"></span>
  </header>

  <section class="wrap">
    <h2 class="title" id="recipeTitle">음식 제목</h2>
    <p class="desc" id="recipeDesc">음식 간략 설명</p>
    <div class="hero-photo" aria-label="대표 이미지"></div>

    <ol class="step-flow" id="stepList">
      <li class="step-block">
        <div class="s-head"><span class="tri"></span><strong>1. 재료를 준비한다.</strong></div>
        <div class="photo" aria-label="1단계 사진"></div>
        <p class="s-body">필요한 재료를 손질합니다.</p>
      </li>
      <li class="step-block">
        <div class="s-head"><span class="tri"></span><strong>2. 재료를 썬다.</strong></div>
        <p class="s-body">식감에 맞게 썰어줍니다.</p>
      </li>
      <li class="step-block">
        <div class="s-head"><span class="tri"></span><strong>3. 간을 맞춘다.</strong></div>
        <div class="photo" aria-label="3단계 사진"></div>
        <p class="s-body">간장/버터로 간을 맞춰 볶습니다.</p>
      </li>
    </ol>

    <div id="moreSentinel" aria-hidden="true"></div>
  </section>

  <!-- 플로팅 액션 -->
  <div class="float-actions" aria-label="액션">
    <button class="fab" id="likeBtn" aria-pressed="false" title="좋아요">
      <svg viewBox="0 0 24 24" width="22" height="22" class="ico-heart">
        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5
                 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09
                 C13.09 3.81 14.76 3 16.5 3
                 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55
                 11.54L12 21.35z"/>
      </svg>
    </button>

    <div class="rating-wrap" id="ratingWrap">
      <button class="fab star-trigger" id="starTrigger" aria-expanded="false" title="별점 주기">
        <svg viewBox="0 0 24 24" width="22" height="22" class="ico-star">
          <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2
                   9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
        </svg>
      </button>
      <div class="rating-pop" id="ratingPop" role="radiogroup" aria-label="별점 선택" hidden>
        <button class="star" data-value="1" role="radio" aria-checked="false" aria-label="1점"><svg viewBox="0 0 24 24" width="22" height="22"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg></button>
        <button class="star" data-value="2" role="radio" aria-checked="false" aria-label="2점"><svg viewBox="0 0 24 24" width="22" height="22"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg></button>
        <button class="star" data-value="3" role="radio" aria-checked="false" aria-label="3점"><svg viewBox="0 0 24 24" width="22" height="22"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg></button>
        <button class="star" data-value="4" role="radio" aria-checked="false" aria-label="4점"><svg viewBox="0 0 24 24" width="22" height="22"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg></button>
        <button class="star" data-value="5" role="radio" aria-checked="false" aria-label="5점"><svg viewBox="0 0 24 24" width="22" height="22"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg></button>
      </div>
    </div>
  </div>

  <!-- 탭바(항상 흰색, 폭 딱 맞춤) -->
  <nav class="tabbar" aria-label="하단 탭">
    <a class="tab" href="menu.html" aria-label="메뉴">
      <svg viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16" stroke="#6b7280" stroke-width="2" fill="none"/></svg>
    </a>
    <a class="tab is-active" href="likes.html" aria-label="좋아요">
      <svg viewBox="0 0 24 24" width="24" height="24" fill="#6b7280">
        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
      </svg>
    </a>
    <a class="tab" href="search.html" aria-label="검색">
      <div class="ring">
        <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="7" stroke="#6b7280" stroke-width="2" fill="none"/><path d="M20 20l-3.5-3.5" stroke="#6b7280" stroke-width="2" fill="none"/></svg>
      </div>
    </a>
    <a class="tab" href="post_upload.html" aria-label="업로드">
      <svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke="#6b7280" stroke-width="2" fill="none"/></svg>
    </a>
    <a class="tab" href="profile.html" aria-label="프로필">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4" stroke="#6b7280" stroke-width="2" fill="none"/><path d="M4 20c2-4 14-4 16 0" stroke="#6b7280" stroke-width="2" fill="none"/></svg>
    </a>
  </nav>
</main>

<script>
  // 좋아요 토글
  const likeBtn = document.getElementById('likeBtn');
  likeBtn?.addEventListener('click', ()=>{
    likeBtn.classList.toggle('is-on');
    likeBtn.setAttribute('aria-pressed', likeBtn.classList.contains('is-on'));
  });

  // 별점 팝오버
  const starTrigger = document.getElementById('starTrigger');
  const ratingPop   = document.getElementById('ratingPop');
  const ratingWrap  = document.getElementById('ratingWrap');
  let currentRating = 0;

  function openRating(){ ratingPop.hidden = false; starTrigger.setAttribute('aria-expanded','true'); }
  function closeRating(){ ratingPop.hidden = true;  starTrigger.setAttribute('aria-expanded','false'); }

  starTrigger.addEventListener('click', e => { e.stopPropagation(); ratingPop.hidden ? openRating() : closeRating(); });
  ratingPop.querySelectorAll('.star').forEach(btn=>{
    btn.addEventListener('click', e=>{
      e.stopPropagation();
      currentRating = Number(btn.dataset.value);
      ratingPop.querySelectorAll('.star').forEach(s=> s.classList.toggle('on', Number(s.dataset.value)<=currentRating));
      closeRating();
    });
  });
  document.addEventListener('click', e=>{ if(!ratingWrap.contains(e.target)) closeRating(); });

  // 더미 무한 스크롤
  const rootEl = document.querySelector('.phone');
  const stepList = document.getElementById('stepList');
  const sentinel = document.getElementById('moreSentinel');
  const extraSteps = [
    {t:'4. 불 조절', img:false, body:'타지 않게 중불로 조절합니다.'},
    {t:'5. 마무리 간', img:false, body:'소금/후추로 마무리.'},
    {t:'6. 플레이팅', img:true,  body:'그릇에 담고 고명을 올립니다.'},
    {t:'7. 서빙',     img:false, body:'따뜻할 때 식탁으로.'}
  ];
  let cursor=0, CHUNK=2;

  function appendChunk(){
    if(cursor>=extraSteps.length) return;
    const slice = extraSteps.slice(cursor, cursor+CHUNK);
    slice.forEach(s=>{
      const li=document.createElement('li');
      li.className='step-block';
      li.innerHTML = `
        <div class="s-head"><span class="tri"></span><strong>${s.t}</strong></div>
        ${s.img?'<div class="photo"></div>':''}
        <p class="s-body">${s.body}</p>`;
      stepList.appendChild(li);
    });
    cursor+=slice.length;
  }

  const io = new IntersectionObserver(es=>{
    es.forEach(e=>{
      if(e.isIntersecting){ appendChunk(); if(cursor>=extraSteps.length) io.disconnect(); }
    });
  },{ root:rootEl, rootMargin:'200px 0px', threshold:0 });
  io.observe(sentinel);

  function nearBottom(el){ return el.scrollHeight - el.scrollTop - el.clientHeight < 220; }
  ['scroll','touchmove'].forEach(ev=>{
    rootEl.addEventListener(ev, ()=>{ if(nearBottom(rootEl)) appendChunk(); }, {passive:true});
  });
</script>
<script>
  // 실제 가시 높이를 --app-vh에 반영(주소창 등장/숨김 대응)
  function setVH(){
    document.documentElement.style.setProperty('--app-vh', window.innerHeight + 'px');
  }
  setVH();
  window.addEventListener('resize', setVH);
  window.addEventListener('orientationchange', setVH);
</script>

</body>
</html>
